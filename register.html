<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SUDGEC 2025 Registration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-green-100 to-green-200 relative text-slate-800">

  <!-- Background -->
  <div class="absolute inset-0 bg-[url('/assets/img/banner.jpg')] bg-cover bg-center opacity-20"></div>

  <!-- Registration Form -->
  <main id="formSection" class="relative z-10 w-full max-w-3xl bg-white/95 rounded-3xl shadow-2xl p-10 space-y-8 backdrop-blur-md">
    <div class="text-center">
      <img src="/assets/img/logo.BpdcY0v0.png" alt="SUDGEC Logo" class="w-20 h-20 mx-auto mb-3">
      <h1 class="text-3xl font-extrabold text-green-800">SUDGEC 2025 Participant Registration</h1>
      <p class="text-slate-600 mt-2">
        Sustainable Development Goals Evaluation Conference  
        <br><span class="text-sm text-slate-500">üìÖ Date: December 2nd - 4th, 2025 ‚Ä¢ üìç Ibom Led (formerly Ibom e-Library), IBB Way, Uyo, Akwa Ibom State, Nigeria | ‚è∞ 10:00 AM Daily</span>
      </p>
    </div>

    <form id="registerForm" class="space-y-8">

      <!-- Participant Information -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Participant Information</h2>
        <div class="grid md:grid-cols-2 gap-4">
          <input id="fullName" placeholder="Full Name" required class="form-input">
          <input id="title" placeholder="Title/Position" class="form-input">
          <input id="institution" placeholder="Institution/Organization" class="form-input">
          <input id="department" placeholder="Department" class="form-input">
          <input id="email" type="email" placeholder="Email" required class="form-input">
          <input id="phone" placeholder="Phone Number" class="form-input">
        </div>
      </section>

      <!-- Registration Type -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Registration Type</h2>

        <p class="text-sm text-slate-600 italic mb-3">
          * Dollar ($) rates apply only to international participants.<br>
          * Naira (‚Ç¶) rates apply to participants resident in Nigeria.
        </p>

        <div class="space-y-2 text-slate-700">
          <label class="block">
            <input type="radio" name="regType" value="International Participant ($3000)" class="mr-2">
            International Participant ‚Äì <span class="text-green-700 font-medium">$3,000</span>
          </label>

          <label class="block">
            <input type="radio" name="regType" value="Nigeria Resident Participant (‚Ç¶350000)" class="mr-2">
            Nigeria Resident Participant ‚Äì <span class="text-green-700 font-medium">‚Ç¶350,000</span>
          </label>
        </div>

        <!-- Early Bird Discount Info -->
        <div class="mt-4 bg-green-50 border border-green-200 rounded-md p-4 text-sm text-slate-700">
          <h3 class="font-semibold text-green-700 mb-2">üéâ Early Bird Conference Payment Rates</h3>
          <ul class="list-disc list-inside space-y-1">
            <li><strong>Before November 20th, 2025</strong> ‚Äì <span class="text-green-700 font-medium">15% discount</span></li>
            <li><strong>Before November 27th, 2025</strong> ‚Äì <span class="text-green-700 font-medium">10% discount</span></li>
            <li><strong>On the event date</strong> ‚Äì 100% of the regular fee applies.</li>
          </ul>
        </div>
      </section>

      <!-- Conference Participation -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Conference Participation</h2>
        <div class="space-y-3">
          <label><input type="checkbox" id="isPresenter" class="mr-2">Presenter</label>
          <input id="presentationTitle" placeholder="Title of Presentation" class="form-input">
          <select id="sessionPreference" class="form-input">
            <option value="">Session Preference</option>
            <option value="Oral">Oral</option>
            <option value="Poster">Poster</option>
            <option value="Both">Both</option>
          </select>
        </div>
      </section>

      <!-- Payment Information -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Payment Information</h2>

        <div class="space-y-3">
          <select id="paymentMethod" class="form-input">
            <option value="">Select Payment Method</option>
            <option>Bank Transfer</option>
            <option>Credit Card</option>
            <option>Other</option>
          </select>

          <div>
            <label for="amount" class="block text-sm font-medium text-slate-700 mb-1">Amount to Pay</label>
            <input id="amount" placeholder="Amount (‚Ç¶ or $)" class="form-input" readonly>
            <p id="discountNote" class="text-xs text-green-700 mt-1 hidden"></p>
          </div>

          <input id="transactionId" placeholder="Transaction ID / Reference Number" class="form-input">
        </div>
      </section>

      <!-- Accommodation -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Accommodation</h2>
        <div class="space-y-3">
          <label><input type="checkbox" id="hotelReservation" class="mr-2">Hotel Reservation</label>
          <select id="accommodationType" class="form-input">
            <option value="">Type of Accommodation</option>
            <option>Single</option>
            <option>Double</option>
          </select>
        </div>
      </section>

      <!-- Dietary Restrictions -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Dietary Restrictions</h2>
        <div class="space-y-3">
          <label><input type="checkbox" id="vegetarian" class="mr-2">Vegetarian</label>
          <input id="otherDiet" placeholder="Other Dietary Restrictions" class="form-input">
        </div>
      </section>

      <!-- Declaration -->
      <section>
        <h2 class="text-lg font-semibold text-green-700 border-b pb-2 mb-4">Declaration</h2>
        <p class="text-sm text-slate-700 mb-3">
          I confirm that the information provided is accurate and complete. I understand that the registration fee is non-refundable.
        </p>
        <div class="grid md:grid-cols-2 gap-4">
          <input id="signature" placeholder="Signature" class="form-input">
          <input id="date" type="date" class="form-input">
        </div>
      </section>

      <div class="flex gap-3">
        <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md shadow-md transition hover:scale-[1.02]">
        Submit Registration
      </button>
       <button type="button" class="navigate-to-payment w-full py-3 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-md shadow-md transition hover:scale-[1.02]">
        Already Register Proceed to Payment
      </button> 
      </div>
    </form>
  </main>


<!-- ‚úÖ Confirmation Screen -->
<main id="confirmation" class="hidden relative z-10 w-full max-w-xl bg-white/95 rounded-3xl shadow-2xl p-10 text-center space-y-5 backdrop-blur-md">
  <div class="flex justify-center">
    <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </div>
  </div>

  <h2 class="text-2xl font-extrabold text-green-700">üéâ Registration Successful!</h2>
  <p class="text-slate-700 font-medium">
    Thank you for registering for <strong>SUDGEC 2025</strong>.  
    A confirmation email has been sent to your inbox.
  </p>

  <div class="flex flex-col space-y-3">
    <a href="index.html"
      class="inline-block px-6 py-3 bg-gray-200 hover:bg-gray-300 text-slate-700 font-semibold rounded-md shadow-md transition">
      Return to Home
    </a>

    <!-- Proceed to Payment Button -->
    <button id="proceedPayment"
      class="inline-block px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md shadow-md transition">
      Proceed to Payment
    </button>
  </div>
</main>


  <script>
    tailwind.config = { theme: { extend: { colors: { primary: "#047857" } } } };

    (function () {
      emailjs.init("FsRfW-MnD022Dlzor");
    })();

    // Apply Tailwind styling to inputs
    document.querySelectorAll('.form-input').forEach(el => {
      el.classList.add(
        'w-full', 'px-4', 'py-2', 'rounded-md', 'border', 'border-slate-300',
        'bg-transparent', 'focus:ring-2', 'focus:ring-green-500', 'outline-none'
      );
    });

    // Update payment info when registration type is selected
    document.querySelectorAll('input[name="regType"]').forEach(radio => {
      radio.addEventListener('change', function () {
        const amountField = document.getElementById('amount');
        const discountNote = document.getElementById('discountNote');

        if (this.value.includes('International')) {
          amountField.value = '$3,000';
          discountNote.innerHTML = `
            üí∞ <strong>Early Bird Discounts:</strong><br>
            ‚Ä¢ Before Nov 10th ‚Äì 15% off ($2,550)<br>
            ‚Ä¢ Before Nov 15th ‚Äì 10% off ($2,700)
          `;
        } else {
          amountField.value = '‚Ç¶350,000';
          discountNote.innerHTML = `
            üí∞ <strong>Early Bird Discounts:</strong><br>
            ‚Ä¢ Before Nov 10th ‚Äì 15% off (‚Ç¶297,500)<br>
            ‚Ä¢ Before Nov 15th ‚Äì 10% off (‚Ç¶315,000)
          `;
        }
        discountNote.classList.remove('hidden');
      });
    });

    // Form submission
    document.getElementById('registerForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const data = {
        fullName: document.getElementById('fullName').value,
        title: document.getElementById('title').value,
        institution: document.getElementById('institution').value,
        department: document.getElementById('department').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        regType: document.querySelector('input[name="regType"]:checked')?.value || '',
        isPresenter: document.getElementById('isPresenter').checked ? 'Yes' : 'No',
        presentationTitle: document.getElementById('presentationTitle').value,
        sessionPreference: document.getElementById('sessionPreference').value,
        paymentMethod: document.getElementById('paymentMethod').value,
        transactionId: document.getElementById('transactionId').value,
        hotelReservation: document.getElementById('hotelReservation').checked ? 'Yes' : 'No',
        accommodationType: document.getElementById('accommodationType').value,
        vegetarian: document.getElementById('vegetarian').checked ? 'Yes' : 'No',
        otherDiet: document.getElementById('otherDiet').value,
        signature: document.getElementById('signature').value,
        date: document.getElementById('date').value,
        amount: document.getElementById('amount').value,
        discountNote: document.getElementById('discountNote').innerText
      };

      // Send data to Hostinger backend
      fetch("https://sustainsudgecorg.org/submit.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
        .then(res => res.json())
        .then(response => {
          if (response.success) console.log("‚úÖ Saved to database successfully!");
          else console.error("‚ùå Database error:", response.error);
        })
        .catch(err => console.error("‚ùå Connection error:", err));

      // Send confirmation email
      const message = `
        SUDGEC 2025 Registration Form Submission:

        Full Name: ${data.fullName}
        Institution: ${data.institution}
        Email: ${data.email}
        Phone: ${data.phone}
        Registration Type: ${data.regType}
        Amount: ${data.amount}

        Presenter: ${data.isPresenter}
        Payment Method: ${data.paymentMethod}
        Transaction ID: ${data.transactionId}

        Date: ${data.date}
      `;
emailjs.send("service_6bb6y4a", "template_ocln91b", {
  to_name: data.fullName,
  to_email: data.email, // üëà required for recipient
  from_name: "SUDGEC 2025 Organizing Team",
  message: message,
})

// After successful registration + email sent
.then(() => {
  document.getElementById('formSection').classList.add('hidden');
  document.getElementById('confirmation').classList.remove('hidden');

  // ‚úÖ Add Proceed to Payment redirect
  const proceedBtn = document.getElementById("proceedPayment");
  proceedBtn.addEventListener("click", () => {
    const fullName = encodeURIComponent(document.getElementById("fullName").value);
    const email = encodeURIComponent(document.getElementById("email").value);
    const phone = encodeURIComponent(document.getElementById("phone").value);
    const regType = encodeURIComponent(document.querySelector('input[name="regType"]:checked')?.value || '');
    const amount = encodeURIComponent(document.getElementById("amount").value);

    // Redirect to payment page with user data in the URL
    window.location.href = `payment.html?name=${fullName}&email=${email}&phone=${phone}&regType=${regType}&amount=${amount}`;
  });
})


    });





// When "Proceed to Payment" is clicked
document.getElementById("proceedToPayment").addEventListener("click", function () {
  const fullName = document.getElementById("fullName").value;
  const email = document.getElementById("email").value;
  const phone = document.getElementById("phone").value;
  const regType = document.querySelector('input[name="regType"]:checked')?.value || '';
  const rawAmount = document.getElementById("amount").value;

  // Parse numeric amount accurately
  let amountValue = parseFloat(rawAmount.replace(/[‚Ç¶$,]/g, '').replace(/,/g, ''));
  let currency = regType.includes("International") ? "USD" : "NGN";

  // Flutterwave Checkout
  FlutterwaveCheckout({
    public_key: "FLWPUBK_TEST-db94a44d6815da7110d5d7da3a3f48ec-X", // replace with your Flutterwave public key
    tx_ref: "SUDGEC_" + Date.now(),
    amount: amountValue,
    currency: currency,
    payment_options: "card, banktransfer, ussd",
    customer: {
      email: email,
      phone_number: phone,
      name: fullName,
    },
    meta: {
      registration_type: regType,
    },
    customizations: {
      title: "SUDGEC 2025 Conference Fee",
      description: "Payment for SUDGEC 2025 registration",
      logo: "https://sustainsudgecorg.org/assets/logo.BpdcY0v0.png",
    },
    callback: function (data) {
      if (data.status === "successful") {
        // ‚úÖ Show Receipt Screen
        document.getElementById("confirmation").classList.add("hidden");
        document.getElementById("receiptScreen").classList.remove("hidden");

        // Render payment details
        const detailsHTML = `
          <p><strong>Name:</strong> ${fullName}</p>
          <p><strong>Email:</strong> ${email}</p>
          <p><strong>Phone:</strong> ${phone}</p>
          <p><strong>Registration Type:</strong> ${regType}</p>
          <p><strong>Amount Paid:</strong> ${currency} ${amountValue.toLocaleString()}</p>
          <p><strong>Transaction Reference:</strong> ${data.tx_ref}</p>
          <p><strong>Payment Status:</strong> ${data.status}</p>
          <p><strong>Date:</strong> ${new Date().toLocaleString()}</p>
        `;
        document.getElementById("receiptDetails").innerHTML = detailsHTML;

        // Save to DB
        fetch("https://sustainsudgecorg.org/payment-confirm.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: fullName,
            email: email,
            phone: phone,
            amount: amountValue,
            tx_ref: data.tx_ref,
            currency: currency,
            regType: regType,
            payment_status: data.status,
          }),
        }).then(res => res.json()).then(console.log);
      } else {
        alert("‚ùå Payment not completed or cancelled.");
      }
    },
    onclose: function () {
      console.log("Payment modal closed");
    },
  });
});

// üìÑ Generate downloadable PDF receipt
document.getElementById("downloadReceipt").addEventListener("click", () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const receiptContent = document.getElementById("receiptDetails").innerText;
  pdf.setFont("helvetica", "normal");
  pdf.text("SUDGEC 2025 - Payment Receipt", 20, 20);
  pdf.text(receiptContent, 20, 40);
  pdf.save("SUDGEC2025_Receipt.pdf");
});

  </script>
  <script>
    document.querySelector(".navigate-to-payment").addEventListener("click", () =>{
      document.location.assign("/payment.html")
    })
  </script>
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</body>
</html>
